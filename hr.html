<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HR Portal - Job Applications - Tiba Manzalawi Group</title>
  <link rel="stylesheet" href="global-design-system.css">
  <link rel="stylesheet" href="css/admin.css">
</head>
<body>
  <div id="hr-app">
    <div style="display: flex; align-items: center; justify-content: center; min-height: 100vh; background: #F8F9FA;">
      <div style="text-align: center;">
        <div style="width: 40px; height: 40px; border: 4px solid #E2E8F0; border-top-color: #3B82F6; border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto 1rem;"></div>
        <p style="color: #64748B;">Checking authentication...</p>
      </div>
    </div>
  </div>
  
  <style>
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>

  <script src="js/admin-components.js"></script>
  <script src="js/hr-auth.js"></script>
  <script src="js/hr-applications.js"></script>

  <script>
    (function() {
      'use strict';
      
      let initialized = false;
      
      async function init() {
        if (initialized) return;
        initialized = true;

        console.log('=== HR.HTML INIT STARTING ===');
        
        const token = localStorage.getItem('hrToken');
        console.log('HR Token in localStorage:', token ? 'Yes (' + token.substring(0, 20) + '...)' : 'No');
        
        if (!token) {
          console.log('❌ No HR token found, redirecting to login');
          window.location.replace('hr-login.html');
          return;
        }

        // Check auth
        try {
          const auth = await window.HRAuth.checkAuth();
          console.log('HR Auth check result:', auth);
          
          if (!auth) {
            console.log('❌ Not authenticated, should have redirected');
            return;
          }

          console.log('✅ HR Authenticated! Setting up app...');

          // Setup HR layout
          if (window.HRApplications) {
            window.HRApplications.init();
          }

        } catch (error) {
          console.error('HR Authentication check failed:', error);
          alert('Authentication failed. Please try logging in again.');
          window.location.replace('hr-login.html');
        }
      }
      
      if (document.readyState === 'complete' || document.readyState === 'interactive') {
        init();
      } else {
        window.addEventListener('DOMContentLoaded', init);
      }
    })();
  </script>
</body>
</html>

